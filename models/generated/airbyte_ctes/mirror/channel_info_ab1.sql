{{ config(
    unique_key = '_airbyte_ab_id',
    schema = "_airbyte_mirror",
    tags = [ "top-level-intermediate" ]
) }}
-- SQL model to parse JSON blob stored in a single column and extract into separated field columns as described by the JSON Schema
-- depends_on: {{ source('mirror', '_airbyte_raw_channel_info') }}
select
    {{ json_extract_scalar('_airbyte_data', ['lang'], ['lang']) }} as lang,
    {{ json_extract_scalar('_airbyte_data', ['links'], ['links']) }} as links,
    {{ json_extract_scalar('_airbyte_data', ['score'], ['score']) }} as score,
    {{ json_extract_scalar('_airbyte_data', ['title'], ['title']) }} as title,
    {{ json_extract_scalar('_airbyte_data', ['d_lang'], ['d_lang']) }} as d_lang,
    {{ json_extract_scalar('_airbyte_data', ['vid_db'], ['vid_db']) }} as vid_db,
    {{ json_extract_scalar('_airbyte_data', ['country'], ['country']) }} as country,
    {{ json_extract_scalar('_airbyte_data', ['fb_link'], ['fb_link']) }} as fb_link,
    {{ json_extract_scalar('_airbyte_data', ['ranking'], ['ranking']) }} as ranking,
    {{ json_extract_scalar('_airbyte_data', ['remarks'], ['remarks']) }} as remarks,
    {{ json_extract_scalar('_airbyte_data', ['vid_api'], ['vid_api']) }} as vid_api,
    {{ json_extract_scalar('_airbyte_data', ['category'], ['category']) }} as category,
    {{ json_extract_scalar('_airbyte_data', ['comments'], ['comments']) }} as comments,
    {{ json_extract_scalar('_airbyte_data', ['channelid'], ['channelid']) }} as channelid,
    {{ json_extract_scalar('_airbyte_data', ['hash_data'], ['hash_data']) }} as hash_data,
    {{ json_extract_scalar('_airbyte_data', ['is_hidden'], ['is_hidden']) }} as is_hidden,
    {{ json_extract_scalar('_airbyte_data', ['is_linked'], ['is_linked']) }} as is_linked,
    {{ json_extract_scalar('_airbyte_data', ['thumbnail'], ['thumbnail']) }} as thumbnail,
    {{ json_extract_scalar('_airbyte_data', ['user_name'], ['user_name']) }} as user_name,
    {{ json_extract_scalar('_airbyte_data', ['viewcount'], ['viewcount']) }} as viewcount,
    {{ json_extract_scalar('_airbyte_data', ['is_deleted'], ['is_deleted']) }} as is_deleted,
    {{ json_extract_scalar('_airbyte_data', ['risk_level'], ['risk_level']) }} as risk_level,
    {{ json_extract_scalar('_airbyte_data', ['subscriber'], ['subscriber']) }} as subscriber,
    {{ json_extract_scalar('_airbyte_data', ['title_lang'], ['title_lang']) }} as title_lang,
    {{ json_extract_scalar('_airbyte_data', ['updated_at'], ['updated_at']) }} as updated_at,
    {{ json_extract_scalar('_airbyte_data', ['description'], ['description']) }} as description,
    {{ json_extract_scalar('_airbyte_data', ['inserted_at'], ['inserted_at']) }} as inserted_at,
    {{ json_extract_scalar('_airbyte_data', ['is_verified'], ['is_verified']) }} as is_verified,
    {{ json_extract_scalar('_airbyte_data', ['lang_status'], ['lang_status']) }} as lang_status,
    {{ json_extract_scalar('_airbyte_data', ['publishedat'], ['publishedat']) }} as publishedat,
    {{ json_extract_scalar('_airbyte_data', ['tier_status'], ['tier_status']) }} as tier_status,
    {{ json_extract_scalar('_airbyte_data', ['video_count'], ['video_count']) }} as video_count,
    {{ json_extract_scalar('_airbyte_data', ['d_lang_score'], ['d_lang_score']) }} as d_lang_score,
    {{ json_extract_scalar('_airbyte_data', ['is_processed'], ['is_processed']) }} as is_processed,
    {{ json_extract_scalar('_airbyte_data', ['topic_status'], ['topic_status']) }} as topic_status,
    {{ json_extract_scalar('_airbyte_data', ['lang_raw_data'], ['lang_raw_data']) }} as lang_raw_data,
    {{ json_extract_scalar('_airbyte_data', ['made_for_kids'], ['made_for_kids']) }} as made_for_kids,
    {{ json_extract_scalar('_airbyte_data', ['monthly_views'], ['monthly_views']) }} as monthly_views,
    {{ json_extract_scalar('_airbyte_data', ['title_summary'], ['title_summary']) }} as title_summary,
    {{ json_extract_scalar('_airbyte_data', ['views_history'], ['views_history']) }} as views_history,
    {{ json_extract_scalar('_airbyte_data', ['is_blacklisted'], ['is_blacklisted']) }} as is_blacklisted,
    {{ json_extract_scalar('_airbyte_data', ['privacy_status'], ['privacy_status']) }} as privacy_status,
    {{ json_extract_scalar('_airbyte_data', ['summary_status'], ['summary_status']) }} as summary_status,
    {{ json_extract_scalar('_airbyte_data', ['already_updated'], ['already_updated']) }} as already_updated,
    {{ json_extract_scalar('_airbyte_data', ['brands_keywords'], ['brands_keywords']) }} as brands_keywords,
    {{ json_extract_scalar('_airbyte_data', ['topiccategories'], ['topiccategories']) }} as topiccategories,
    {{ json_extract_scalar('_airbyte_data', ['default_language'], ['default_language']) }} as default_language,
    {{ json_extract_scalar('_airbyte_data', ['last_stats_update'], ['last_stats_update']) }} as last_stats_update,
    {{ json_extract_scalar('_airbyte_data', ['predicted_lang_v1'], ['predicted_lang_v1']) }} as predicted_lang_v1,
    {{ json_extract_scalar('_airbyte_data', ['monthly_updated_at'], ['monthly_updated_at']) }} as monthly_updated_at,
    {{ json_extract_scalar('_airbyte_data', ['viewcount_category'], ['viewcount_category']) }} as viewcount_category,
    {{ json_extract_scalar('_airbyte_data', ['white_black_status'], ['white_black_status']) }} as white_black_status,
    {{ json_extract_scalar('_airbyte_data', ['description_summary'], ['description_summary']) }} as description_summary,
    {{ json_extract_scalar('_airbyte_data', ['lang_detected_param'], ['lang_detected_param']) }} as lang_detected_param,
    {{ json_extract_scalar('_airbyte_data', ['monthly_subscribers'], ['monthly_subscribers']) }} as monthly_subscribers,
    {{ json_extract_scalar('_airbyte_data', ['processesing_status'], ['processesing_status']) }} as processesing_status,
    {{ json_extract_scalar('_airbyte_data', ['subscriber_category'], ['subscriber_category']) }} as subscriber_category,
    {{ json_extract_scalar('_airbyte_data', ['subscribers_history'], ['subscribers_history']) }} as subscribers_history,
    {{ json_extract_scalar('_airbyte_data', ['featured_channel_list'], ['featured_channel_list']) }} as featured_channel_list,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at
from {{ source('mirror', '_airbyte_raw_channel_info') }} as table_alias
-- channel_info
where 1 = 1
{{ incremental_clause('_airbyte_emitted_at', this) }}


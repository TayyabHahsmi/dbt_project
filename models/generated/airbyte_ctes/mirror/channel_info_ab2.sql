{{ config(
    unique_key = '_airbyte_ab_id',
    schema = "_airbyte_mirror",
    tags = [ "top-level-intermediate" ]
) }}
-- SQL model to cast each column to its adequate SQL type converted from the JSON schema type
-- depends_on: {{ ref('channel_info_ab1') }}
select
    nullif(accurateCastOrNull(trim(BOTH '"' from lang), '{{ dbt_utils.type_string() }}'), 'null') as lang,
    nullif(accurateCastOrNull(trim(BOTH '"' from links), '{{ dbt_utils.type_string() }}'), 'null') as links,
    accurateCastOrNull(score, '{{ dbt_utils.type_float() }}') as score,
    nullif(accurateCastOrNull(trim(BOTH '"' from title), '{{ dbt_utils.type_string() }}'), 'null') as title,
    nullif(accurateCastOrNull(trim(BOTH '"' from d_lang), '{{ dbt_utils.type_string() }}'), 'null') as d_lang,
    accurateCastOrNull(vid_db, '{{ dbt_utils.type_bigint() }}') as vid_db,
    nullif(accurateCastOrNull(trim(BOTH '"' from country), '{{ dbt_utils.type_string() }}'), 'null') as country,
    nullif(accurateCastOrNull(trim(BOTH '"' from fb_link), '{{ dbt_utils.type_string() }}'), 'null') as fb_link,
    nullif(accurateCastOrNull(trim(BOTH '"' from ranking), '{{ dbt_utils.type_string() }}'), 'null') as ranking,
    nullif(accurateCastOrNull(trim(BOTH '"' from remarks), '{{ dbt_utils.type_string() }}'), 'null') as remarks,
    accurateCastOrNull(vid_api, '{{ dbt_utils.type_bigint() }}') as vid_api,
    nullif(accurateCastOrNull(trim(BOTH '"' from category), '{{ dbt_utils.type_string() }}'), 'null') as category,
    nullif(accurateCastOrNull(trim(BOTH '"' from comments), '{{ dbt_utils.type_string() }}'), 'null') as comments,
    nullif(accurateCastOrNull(trim(BOTH '"' from channelid), '{{ dbt_utils.type_string() }}'), 'null') as channelid,
    {{ cast_to_boolean('hash_data') }} as hash_data,
    accurateCastOrNull(is_hidden, '{{ dbt_utils.type_bigint() }}') as is_hidden,
    accurateCastOrNull(is_linked, '{{ dbt_utils.type_bigint() }}') as is_linked,
    nullif(accurateCastOrNull(trim(BOTH '"' from thumbnail), '{{ dbt_utils.type_string() }}'), 'null') as thumbnail,
    nullif(accurateCastOrNull(trim(BOTH '"' from user_name), '{{ dbt_utils.type_string() }}'), 'null') as user_name,
    accurateCastOrNull(viewcount, '{{ dbt_utils.type_bigint() }}') as viewcount,
    {{ cast_to_boolean('is_deleted') }} as is_deleted,
    nullif(accurateCastOrNull(trim(BOTH '"' from risk_level), '{{ dbt_utils.type_string() }}'), 'null') as risk_level,
    accurateCastOrNull(subscriber, '{{ dbt_utils.type_bigint() }}') as subscriber,
    nullif(accurateCastOrNull(trim(BOTH '"' from title_lang), '{{ dbt_utils.type_string() }}'), 'null') as title_lang,
    parseDateTime64BestEffortOrNull(trim(BOTH '"' from {{ empty_string_to_null('updated_at') }})) as updated_at,
    nullif(accurateCastOrNull(trim(BOTH '"' from description), '{{ dbt_utils.type_string() }}'), 'null') as description,
    parseDateTime64BestEffortOrNull(trim(BOTH '"' from {{ empty_string_to_null('inserted_at') }})) as inserted_at,
    {{ cast_to_boolean('is_verified') }} as is_verified,
    accurateCastOrNull(lang_status, '{{ dbt_utils.type_bigint() }}') as lang_status,
    parseDateTime64BestEffortOrNull(trim(BOTH '"' from {{ empty_string_to_null('publishedat') }})) as publishedat,
    nullif(accurateCastOrNull(trim(BOTH '"' from tier_status), '{{ dbt_utils.type_string() }}'), 'null') as tier_status,
    accurateCastOrNull(video_count, '{{ dbt_utils.type_bigint() }}') as video_count,
    accurateCastOrNull(d_lang_score, '{{ dbt_utils.type_float() }}') as d_lang_score,
    {{ cast_to_boolean('is_processed') }} as is_processed,
    accurateCastOrNull(topic_status, '{{ dbt_utils.type_bigint() }}') as topic_status,
    nullif(accurateCastOrNull(trim(BOTH '"' from lang_raw_data), '{{ dbt_utils.type_string() }}'), 'null') as lang_raw_data,
    accurateCastOrNull(made_for_kids, '{{ dbt_utils.type_bigint() }}') as made_for_kids,
    accurateCastOrNull(monthly_views, '{{ dbt_utils.type_bigint() }}') as monthly_views,
    nullif(accurateCastOrNull(trim(BOTH '"' from title_summary), '{{ dbt_utils.type_string() }}'), 'null') as title_summary,
    nullif(accurateCastOrNull(trim(BOTH '"' from views_history), '{{ dbt_utils.type_string() }}'), 'null') as views_history,
    accurateCastOrNull(is_blacklisted, '{{ dbt_utils.type_bigint() }}') as is_blacklisted,
    nullif(accurateCastOrNull(trim(BOTH '"' from privacy_status), '{{ dbt_utils.type_string() }}'), 'null') as privacy_status,
    accurateCastOrNull(summary_status, '{{ dbt_utils.type_bigint() }}') as summary_status,
    {{ cast_to_boolean('already_updated') }} as already_updated,
    nullif(accurateCastOrNull(trim(BOTH '"' from brands_keywords), '{{ dbt_utils.type_string() }}'), 'null') as brands_keywords,
    nullif(accurateCastOrNull(trim(BOTH '"' from topiccategories), '{{ dbt_utils.type_string() }}'), 'null') as topiccategories,
    nullif(accurateCastOrNull(trim(BOTH '"' from default_language), '{{ dbt_utils.type_string() }}'), 'null') as default_language,
    parseDateTime64BestEffortOrNull(trim(BOTH '"' from {{ empty_string_to_null('last_stats_update') }})) as last_stats_update,
    nullif(accurateCastOrNull(trim(BOTH '"' from predicted_lang_v1), '{{ dbt_utils.type_string() }}'), 'null') as predicted_lang_v1,
    toDate(parseDateTimeBestEffortOrNull(trim(BOTH '"' from {{ empty_string_to_null('monthly_updated_at') }}))) as monthly_updated_at,
    nullif(accurateCastOrNull(trim(BOTH '"' from viewcount_category), '{{ dbt_utils.type_string() }}'), 'null') as viewcount_category,
    nullif(accurateCastOrNull(trim(BOTH '"' from white_black_status), '{{ dbt_utils.type_string() }}'), 'null') as white_black_status,
    nullif(accurateCastOrNull(trim(BOTH '"' from description_summary), '{{ dbt_utils.type_string() }}'), 'null') as description_summary,
    nullif(accurateCastOrNull(trim(BOTH '"' from lang_detected_param), '{{ dbt_utils.type_string() }}'), 'null') as lang_detected_param,
    accurateCastOrNull(monthly_subscribers, '{{ dbt_utils.type_bigint() }}') as monthly_subscribers,
    nullif(accurateCastOrNull(trim(BOTH '"' from processesing_status), '{{ dbt_utils.type_string() }}'), 'null') as processesing_status,
    nullif(accurateCastOrNull(trim(BOTH '"' from subscriber_category), '{{ dbt_utils.type_string() }}'), 'null') as subscriber_category,
    nullif(accurateCastOrNull(trim(BOTH '"' from subscribers_history), '{{ dbt_utils.type_string() }}'), 'null') as subscribers_history,
    nullif(accurateCastOrNull(trim(BOTH '"' from featured_channel_list), '{{ dbt_utils.type_string() }}'), 'null') as featured_channel_list,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at
from {{ ref('channel_info_ab1') }}
-- channel_info
where 1 = 1
{{ incremental_clause('_airbyte_emitted_at', this) }}

